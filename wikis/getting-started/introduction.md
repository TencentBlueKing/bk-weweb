# 简介

## 什么是 BK-WeWeb

BK-WeWeb 是由腾讯蓝鲸团队开源的一款**轻量级微前端框架**。它基于 Web Components 技术，提供了完善的应用隔离机制，让多个独立开发、独立部署的前端应用能够无缝集成在一起运行。

## 核心理念

### 零侵入

子应用无需任何改造即可接入，不需要修改构建配置、不需要暴露生命周期钩子。BK-WeWeb 通过 HTML Entry 的方式自动解析和加载子应用资源。

### 双模式

BK-WeWeb 提供两种运行模式，满足不同的业务场景：

| 模式           | 说明                             | 适用场景           |
| -------------- | -------------------------------- | ------------------ |
| **微应用模式** | 加载完整的远程应用（HTML Entry） | 独立部署的完整应用 |
| **微模块模式** | 加载远程 JS 模块                 | 远程组件、插件系统 |

### 完善隔离

- **JS 沙箱**：基于 Proxy 实现，防止全局变量污染
- **CSS 作用域**：自动添加样式前缀，防止样式冲突
- **路由隔离**：可选的独立 Location/History，多应用路由互不干扰

## 技术架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        主应用 (Host App)                          │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                     BK-WeWeb Runtime                       │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │  │
│  │  │  AppCache   │  │  SandBox    │  │  EntrySource│       │  │
│  │  │  应用缓存    │  │  沙箱环境    │  │  资源解析    │       │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘       │  │
│  └───────────────────────────────────────────────────────────┘  │
│                              │                                    │
│  ┌──────────────────────────┴───────────────────────────────┐  │
│  │                    <bk-weweb> 容器                         │  │
│  │  ┌─────────────────────┐  ┌─────────────────────┐        │  │
│  │  │    MicroAppModel    │  │  MicroInstanceModel │        │  │
│  │  │    微应用实例        │  │    微模块实例         │        │  │
│  │  │  ┌───────────────┐  │  │  ┌───────────────┐  │        │  │
│  │  │  │ ProxyWindow   │  │  │  │ ProxyWindow   │  │        │  │
│  │  │  │ ProxyDocument │  │  │  │ ProxyDocument │  │        │  │
│  │  │  │ CSS Scope     │  │  │  │ CSS Scope     │  │        │  │
│  │  │  │ Location隔离  │  │  │  └───────────────┘  │        │  │
│  │  │  └───────────────┘  │  │                     │        │  │
│  │  └─────────────────────┘  └─────────────────────┘        │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 核心特性

### 1. Web Components 容器

使用自定义元素 `<bk-weweb>` 作为微应用容器，声明式的使用方式，与框架无关。

```html
<bk-weweb
  url="http://app.example.com/"
  id="my-app"
></bk-weweb>
```

### 2. JS 沙箱隔离

基于 ES6 Proxy 实现的沙箱环境，每个子应用拥有独立的 window 代理对象：

- 子应用对 window 的修改不会影响主应用
- 子应用之间的全局变量相互隔离
- 支持 document 代理，自动处理 DOM 操作
- 支持 eval、动态 script 等场景

### 3. CSS 样式隔离

自动为子应用的 CSS 选择器添加作用域前缀：

```css
/* 原始样式 */
.header {
  color: red;
}

/* 处理后 */
#app-name .header {
  color: red;
}
```

同时支持 Shadow DOM 模式提供更彻底的隔离。

### 4. 路由隔离

可选的 `scopeLocation` 功能，为子应用提供独立的 Location 和 History 对象：

- 子应用路由变化不影响浏览器地址栏
- 多个子应用可以同时展示各自的路由页面
- 通过隐藏 iframe 实现原生 Location 行为

### 5. 资源共享

主应用与子应用之间可以共享公共资源：

- 避免重复加载相同的库文件
- 提升应用加载速度
- 减少内存占用

### 6. 预加载

利用浏览器空闲时间预加载资源：

```typescript
import { preLoadApp } from '@blueking/bk-weweb';

preLoadApp({
  url: 'http://app.example.com/',
  id: 'my-app',
});
```

### 7. 丰富的生命周期

提供完整的 Hooks API，支持自定义容器组件：

- `load` / `loadApp` / `loadInstance`
- `mount` / `unmount`
- `activated` / `deactivated`
- `unload`

## 对比其他方案

| 特性       | BK-WeWeb             | qiankun              | micro-app            | iframe      |
| ---------- | -------------------- | -------------------- | -------------------- | ----------- |
| 接入成本   | 低                   | 中                   | 低                   | 低          |
| JS 隔离    | ✅ Proxy             | ✅ Proxy             | ✅ Proxy             | ✅ 天然隔离 |
| CSS 隔离   | ✅ 作用域/Shadow DOM | ✅ 作用域/Shadow DOM | ✅ 作用域/Shadow DOM | ✅ 天然隔离 |
| 通信成本   | 低                   | 低                   | 低                   | 高          |
| 路由同步   | 可选                 | 需配置               | 需配置               | 困难        |
| 资源共享   | ✅                   | ✅                   | ✅                   | ❌          |
| 预加载     | ✅                   | ✅                   | ✅                   | ❌          |
| 微模块模式 | ✅                   | ❌                   | ❌                   | ❌          |

## 浏览器支持

BK-WeWeb 使用了以下现代浏览器特性：

- Web Components (Custom Elements)
- ES6 Proxy
- Shadow DOM (可选)

| 浏览器  | 最低版本 |
| ------- | -------- |
| Chrome  | 67+      |
| Firefox | 63+      |
| Safari  | 10.1+    |
| Edge    | 79+      |

> IE 浏览器不支持

## 下一步

- [快速上手](./quick-start.md) - 5 分钟快速接入
- [微应用模式](../basic/micro-app/README.md) - 深入了解微应用
- [微模块模式](../basic/micro-module/README.md) - 深入了解微模块
